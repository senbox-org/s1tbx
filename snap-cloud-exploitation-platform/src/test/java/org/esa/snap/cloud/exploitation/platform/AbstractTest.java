package org.esa.snap.cloud.exploitation.platform;

import org.apache.commons.lang.StringUtils;
import org.junit.Before;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import static org.junit.Assert.fail;
import static org.junit.Assume.assumeTrue;

/**
 * Created by jcoravu on 15/3/2019.
 */
public abstract class AbstractTest {

    protected Path cloudExploitationPlatformTestsFolderPath;

    public static final String PROPERTY_NAME_DATA_DIR = "snap.cep.tests.data.dir";

    protected AbstractTest() {
    }

    @Before
    public final void setUp() throws Exception {
        Path testFolderPath = testDataAvailable();

        assumeTrue(testFolderPath != null);

        this.cloudExploitationPlatformTestsFolderPath = testFolderPath.resolve("_cloud_exploitation_platform");
        if (!Files.exists(this.cloudExploitationPlatformTestsFolderPath)) {
            fail("The Cloud Exploitation Platform test directory path "+ this.cloudExploitationPlatformTestsFolderPath.toString()+" does not exist.");
        }
    }

    private static Path testDataAvailable() {
        String testDataDir = System.getProperty(PROPERTY_NAME_DATA_DIR);
        if (!StringUtils.isBlank(testDataDir)) {
            Path testFolderPath = Paths.get(testDataDir);
            if (Files.exists(testFolderPath)) {
                return testFolderPath;
            }
        }
        return null;
    }
}
